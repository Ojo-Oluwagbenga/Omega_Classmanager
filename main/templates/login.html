<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up</title>
    <!-- Styles -->
    <link rel="stylesheet" href="../static/signup/css/style.css">
    <link rel="stylesheet" href="../static/general/css/utils.css">
	<link rel="icon" type="image/png" href="../static/general/images/bolt.png"/>
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>    
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
    {%csrf_token%}
    <div class="popalertBox">
        <style>
            .popalertBox{
                position: fixed;
                width: 100vw;
                bottom: 60px;
                display: none;
                z-index: 220;
            }
            .popalertBox .mypop{
                width: max-content;
                max-width: 90%;
                margin: 0px auto;
                padding: 10px 20px;
                border-radius: 10px;
                background-color: #343434;
                transition: opacity 0.3s ease-in;
                color: white;
                font-weight: normal;
                font-family: 'Roboto Condensed', sans-serif;
                font-size: 14px;
                letter-spacing: 0.5px;
                opacity:1;
            }
        </style>
        <div class="mypop">Pop Here</div>
        <script>
            function popAlert(text){
                $(".popalertBox").css('display', 'block');
                $(".popalertBox .mypop").css('opacity', '1').text(text);
                setTimeout(() => {
                    $(".popalertBox .mypop").css('opacity', '0');
                    setTimeout(() => {
                        $(".popalertBox").css('display', 'none');
                    }, 400);
                }, 2000);
            }
        </script>
    </div>
    
    <main class="page flex">
        <section class="page-inner flex" id="userdetails">
            <div class="holder">
                <div class="page-image flex">
                    <img src="../static/signup/img/icon-illustration.svg" alt="">
                </div>
                <div class="page-info">
                    <h1 class="page-title">Let's get back</h1>
                    <div action="">
                        <div class="page-col" id="uniqueid">
                            <label for="matric">Unique ID</label>
                            <input class="page-field page-name" type="text" name="matric"
                                placeholder="Email or Matric ID">
                        </div>     
                        <div class="page-col" id="password">
                            <label for="password">Password</label>
                            <input class="page-field page-pass" type="password" name="password" id="">
                            <img src="../static/signup/img/icon_hide.svg" alt="" class="page-toggle">
                        </div>
                        <button class="page-button" id="sign-up" >Log in</button>
                    </div>
                    <div class="page-login-super">
                        <!-- <div class="page-line">or sign up with</div>
                        <div class="page-link flex">
                            <a class="page-icon" href="">
                                <img src="../static/signup/img/icon-facebook.svg" alt="facebook">
                            </a>
                            <a class="page-icon" href="">
                                <img src="../static/signup/img/icon-google.svg" alt="google">
                            </a>
                        </div> -->
                        <div class="page-login">Don't Have an Account? <a href="./signup" class="page-login-dark">Create an account</a></div>
                    </div>
                </div>
            </div>
        </section>
        <style>
            #userdetails{
                left: 0px;
                display: block;
            }
        </style>
        <script>
            $("#sign-up").click(function(){
                submit_item = {
                    uniqueid:"", 
                    password:"",
                }
                //When the sign up button is clicked
                                
                $(".page-col .errorpack").remove();    
                let errorpack = {

                }
                
                for(const key in submit_item){
                    const val = $("#"+key + " input").val();
                    if (typeof(val) !== 'undefined'){
                        if (val == ""){
                            errorpack[key] = "This entry cannot be empty"
                        }
                        submit_item[key] = val;
                    }
                }
                

                for(let key in errorpack){
                    $("#"+key).append("<span class='errorpack' style='font-size: 13px;'>"+ errorpack[key] +"</span>");
                }

                console.log(submit_item);
                
                if (Object.keys(errorpack).length == 0){
                    axios({
                        method: 'POST',
                        url: '../api/user/validate',
                        headers: {
                            'Cache-Control': 'no-cache',
                            'Pragma': 'no-cache',
                            "X-CSRFToken" : $("input[name='csrfmiddlewaretoken']").val()
                        },
                        data: {
                            ...submit_item,
                            startSession:true
                        }
                    }).then(response => {
                        console.log(response);
                        if (response.data.passed){
                            sessionStorage.clear();
                            sessionStorage.setItem('user_data', JSON.stringify(response.data.response))
                            window.location.href = './dashboard'
                        }else{
                            popAlert(response.data.Message)
                        }
                    }).catch(error => console.error(error))  
                }else{
                    console.log(errorpack);
                }
                


            });
        </script>
    </main>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</body>

</html>